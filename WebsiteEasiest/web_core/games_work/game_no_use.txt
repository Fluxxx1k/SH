def game_start(game_name):
    print(f'game_start ({game_name})  |  {"not logged in" if "username" not in session else session["username"]}')
    if 'username' not in session:
        return jsonify({'success': False, 'message': 'Not authenticated'}), 401
    game = get_data_of_game(game_name)
    if not game[0]:
        return jsonify({'success': False, 'message': f'Game {game_name} not found: {game[1]}'}), 404
    else:
        game_data = game[1]
    # Load game data
    if game_data['status'] == 'started':
        return jsonify({'success': False, 'message': 'Game already started'}), 400
    if game_data['current_players'] < game_data['min_players']:
        return jsonify({'success': False, 'message': 'Not enough players'}), 400
    # Load game data
    game_file = os.path.join('data', 'games', f'{game_name}.json')
    if not os.path.exists(game_file):
        return jsonify({'success': False, 'message': 'Game not found in server files'}), 404


    # Check if user is the creator
    if game_data['created_by'] != session['username']:
        return jsonify({'success': False, 'message': 'Only game creator can start the game'}), 403

    roles = get_roles(game_data['current_players'])
    players = [WebPlayer(i, game_data['players'], roles[i]) for i in range(len(game_data['players']))]
    from webplayers.web_game import WebGame
    import threading

    def run_game():
        game = WebGame(game_name, players)
        WebGame.globs = GlobalStorage(game_name,
                                    roles=roles[0],
                                    players=players,
                                    count_players=game_data['current_players'],
                                    )
        while game.take_move() != 0:
            continue

    # Start game in separate thread
    game_thread = threading.Thread(target=run_game)
    game_thread.daemon = True
    game_thread.start()

    # Update game status
    game_data['status'] = 'started'
    with open(game_file, 'w', encoding='utf-8') as f:
        json.dump(game_data, f)

    return jsonify({'success': True, 'message': 'Game started'})




# def game_ws(game_name):
#     if 'username' not in session:
#         abort(401, description="Необходимо войти в систему")
#     if game_name == '':
#         abort(404, description="Имя игры не может быть пустым")
#     if not exists_game(game_name):
#         abort(404, description=f"Игра {game_name} не найдена")
#     @socketio.on('connect', namespace=f'/game/{game_name}')
#     def handle_connect():
#         emit('status', {'message': 'Connected to game room'})
